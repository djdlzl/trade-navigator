# 구현 계획: 트레이딩 플랫폼 백엔드 통합

## 개요

이 구현 계획은 기존 트레이딩 대시보드 UI를 Platform API 서비스를 통해 백엔드 트레이딩 엔진과 통합하는 데 중점을 둡니다. 접근 방식은 React 프론트엔드를 Python 트레이딩 엔진과 연결하기 위해 필요한 백엔드 인프라(Python FastAPI)를 생성하고, 실시간 통신, 구성 관리 및 리스크 제어를 구현합니다.

## 작업

- [x] 1. Platform API 프로젝트 구조 및 종속성 설정
  - 적절한 디렉토리 구조로 Python FastAPI 프로젝트 생성
  - 종속성 설치 및 구성: FastAPI, SQLAlchemy, asyncpg, Redis, cryptography, websockets
  - uvicorn 핫 리로딩 및 디버깅으로 개발 환경 설정
  - mypy로 Python 타입 체킹 및 black으로 코드 포맷팅 구성
  - _요구사항: 모든 요구사항 기반_

- [ ]* 1.1 프로젝트 설정 검증을 위한 속성 테스트 작성
  - **속성 1: 데이터 스키마 준수**
  - **검증: 요구사항 1.1, 1.3, 5.5, 6.2**

- [ ] 2. 데이터베이스 스키마 및 구성 관리 구현
  - 사용자 설정 및 엔진 구성을 위한 SQLAlchemy 모델 생성
  - 민감한 데이터를 위한 cryptography 라이브러리를 사용한 암호화 서비스 구현
  - 증권사 API 형식 체크가 있는 구성 검증을 위한 Pydantic 모델 생성
  - 비동기 데이터베이스 연결 풀링 및 Alembic 마이그레이션 시스템 설정
  - _요구사항: 2.1, 2.5, 7.1, 7.5_

- [ ]* 2.1 구성 암호화를 위한 속성 테스트 작성
  - **속성 9: 저장소의 데이터 암호화**
  - **검증: 요구사항 2.5, 7.1, 7.5**

- [ ]* 2.2 구성 지속성을 위한 속성 테스트 작성
  - **속성 5: 구성 지속성**
  - **검증: 요구사항 2.1**

- [ ] 3. 설정 관리를 위한 FastAPI REST 엔드포인트 생성
  - 사용자 구성 저장을 위한 POST /api/settings/user 엔드포인트 구현
  - 사용자 설정 검색을 위한 GET /api/settings/user 엔드포인트 구현
  - API 자격 증명 검증을 위한 POST /api/settings/validate 엔드포인트 구현
  - JWT 인증 미들웨어 및 Pydantic 요청 검증 추가
  - _요구사항: 2.1, 2.4, 7.2, 7.3, 7.4_

- [ ]* 3.1 API 키 검증을 위한 속성 테스트 작성
  - **속성 8: API 키 검증**
  - **검증: 요구사항 2.4**

- [ ]* 3.2 연결성을 통한 구성 검증을 위한 속성 테스트 작성
  - **속성 22: 연결성을 통한 구성 검증**
  - **검증: 요구사항 7.2**

- [ ] 4. 실시간 통신을 위한 WebSocket 게이트웨이 구현
  - 클라이언트 연결을 위한 FastAPI WebSocket 엔드포인트 설정
  - asyncio를 사용한 WebSocket 메시지 라우팅 및 브로드캐스팅 시스템 생성
  - 연결 상태 관리 및 재연결 처리 구현
  - 신뢰할 수 있는 전달을 위한 메시지 확인 시스템 추가
  - _요구사항: 6.1, 6.4, 6.5_

- [ ]* 4.1 WebSocket 연결 수립을 위한 속성 테스트 작성
  - **속성 18: WebSocket 연결 수립**
  - **검증: 요구사항 6.1**

- [ ]* 4.2 메시지 확인을 위한 속성 테스트 작성
  - **속성 20: 메시지 확인**
  - **검증: 요구사항 6.4**

- [ ] 5. 엔진 조정 서비스 생성
  - 비동기 엔진 등록 및 상태 모니터링 구현
  - 연결된 모든 엔진을 위한 긴급 정지 브로드캐스트 시스템 생성
  - asyncio를 사용하여 대상 엔진에 실시간 파라미터 업데이트 배포 구현
  - 엔진 상태 추적 및 연결 상태 관리 추가
  - _요구사항: 3.1, 3.2, 3.3, 3.4, 4.1, 4.2, 4.3_

- [ ]* 5.1 긴급 정지 완전 흐름을 위한 속성 테스트 작성
  - **속성 10: 긴급 정지 완전 흐름**
  - **검증: 요구사항 3.1, 3.2, 3.3, 3.4**

- [ ]* 5.2 실시간 파라미터 업데이트 흐름을 위한 속성 테스트 작성
  - **속성 12: 실시간 파라미터 업데이트 흐름**
  - **검증: 요구사항 4.1, 4.2, 4.3, 4.5**

- [ ] 6. 체크포인트 - Platform API 핵심 기능 작동 확인
  - 모든 테스트가 통과하는지 확인하고, 질문이 있으면 사용자에게 문의합니다.

- [ ] 7. Platform API와 통합하도록 프론트엔드 Settings.tsx 업데이트
  - 모의 handleSave 함수를 POST /api/settings/user에 대한 실제 API 호출로 교체
  - 설정 저장 전 API 자격 증명 검증 추가
  - 설정 작업을 위한 로딩 상태 및 오류 처리 구현
  - 성공적인 저장 및 검증 오류에 대한 토스트 알림 추가
  - _요구사항: 2.1, 2.4_

- [ ]* 7.1 Settings.tsx API 통합을 위한 단위 테스트 작성
  - API 호출, 로딩 상태 및 오류 처리 테스트
  - _요구사항: 2.1, 2.4_

- [ ] 8. 긴급 정지 및 실시간 파라미터를 위한 프론트엔드 Strategies.tsx 업데이트
  - 긴급 정지 버튼을 Platform API 긴급 정지 엔드포인트와 통합
  - 파라미터 업데이트 API 호출로 "Apply to Live" 기능 구현
  - 적절한 로딩 상태 및 확인 대화 상자 추가
  - API 응답 처리 및 적절한 토스트 알림 표시
  - _요구사항: 3.1, 4.1_

- [ ]* 8.1 Strategies.tsx API 통합을 위한 단위 테스트 작성
  - 긴급 정지 흐름 및 파라미터 업데이트 기능 테스트
  - _요구사항: 3.1, 4.1_

- [ ] 9. 실시간 데이터를 소비하도록 SystemHealthPanel 업데이트
  - 모의 systemHealthData를 Platform API에 대한 WebSocket 연결로 교체
  - 연결된 엔진의 실시간 상태 메트릭 업데이트 구현
  - 연결 손실 감지 및 오프라인 표시기 추가
  - WebSocket 재연결 및 오류 상태 처리
  - _요구사항: 5.1, 5.2, 5.3, 5.4_

- [ ]* 9.1 연결 손실 감지를 위한 속성 테스트 작성
  - **속성 17: 연결 손실 감지**
  - **검증: 요구사항 5.4**

- [ ]* 9.2 상태 보고 완전성을 위한 속성 테스트 작성
  - **속성 15: 상태 보고 완전성**
  - **검증: 요구사항 5.2**

- [ ] 10. 실시간 거래 로그를 소비하도록 TradeTerminal 업데이트
  - 모의 categorizedTradeLogs를 실시간 거래 데이터를 위한 WebSocket 연결로 교체
  - 연결된 엔진의 실시간 로그 스트리밍 구현
  - 엔진 데이터의 적절한 로그 분류 및 포맷팅 보장
  - 잘못된 형식의 로그 데이터에 대한 오류 처리 추가
  - _요구사항: 1.3, 1.4, 6.2_

- [ ]* 10.1 거래 로그 이유 필드 요구사항을 위한 속성 테스트 작성
  - **속성 3: 거래 로그 이유 필드 요구사항**
  - **검증: 요구사항 1.4**

- [ ] 11. 오류 처리 및 복구 시스템 구현
  - asyncio를 사용한 API 연결 실패에 대한 지수 백오프 추가
  - 응답하지 않는 서비스에 대한 회로 차단기 패턴 구현
  - 포괄적인 오류 로깅 및 감사 추적 시스템 생성
  - 부분 시스템 실패에 대한 우아한 성능 저하 추가
  - _요구사항: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ]* 11.1 우아한 성능 저하를 통한 오류 복구를 위한 속성 테스트 작성
  - **속성 25: 우아한 성능 저하를 통한 오류 복구**
  - **검증: 요구사항 8.1, 8.2, 8.3, 8.4, 8.5**

- [ ] 12. 엔진 통신 프로토콜 사양 생성
  - Python 엔진 통합을 위한 WebSocket 메시지 형식 문서화
  - Python 트레이딩 엔진을 위한 Pydantic 데이터 스키마 요구사항 정의
  - 엔진 연결을 위한 JWT 인증 토큰 시스템 생성
  - 하트비트 타이밍 및 상태 보고 요구사항 지정
  - _요구사항: 5.1, 6.2, 6.3, 7.3_

- [ ]* 12.1 하트비트 타이밍을 위한 속성 테스트 작성
  - **속성 14: 하트비트 타이밍**
  - **검증: 요구사항 5.1**

- [ ]* 12.2 인증된 구성 액세스를 위한 속성 테스트 작성
  - **속성 23: 인증된 구성 액세스**
  - **검증: 요구사항 7.3**

- [ ] 13. 보안 및 감사 로깅 구현
  - 모든 구성 액세스에 대한 포괄적인 감사 로깅 추가
  - 엔진 연결을 위한 JWT 기반 인증 구현
  - 자동 재암호화가 있는 암호화 키 순환 시스템 생성
  - Python 로깅을 사용한 보안 모니터링 및 경고 시스템 추가
  - _요구사항: 7.3, 7.4, 7.5_

- [ ]* 13.1 보안 감사 로깅을 위한 속성 테스트 작성
  - **속성 24: 보안 감사 로깅**
  - **검증: 요구사항 7.4**

- [ ] 14. 통합 테스트 스위트 생성
  - Docker Compose를 사용하여 PostgreSQL 및 Redis 컨테이너로 테스트 환경 설정
  - 통합 테스트를 위한 모의 Python 트레이딩 엔진 생성
  - pytest 및 httpx를 사용한 엔드투엔드 테스트 시나리오 구현
  - locust를 사용한 WebSocket 메시지 처리량에 대한 성능 테스트 추가
  - _요구사항: 모든 요구사항 통합_

- [ ]* 14.1 완전한 시스템 기능을 위한 통합 테스트 작성
  - UI에서 엔진 통신까지의 엔드투엔드 워크플로우 테스트
  - _요구사항: 모든 요구사항 통합_

- [ ] 15. 최종 체크포인트 - 완전한 통합 작동 확인
  - 모든 테스트가 통과하는지 확인하고, 질문이 있으면 사용자에게 문의합니다.

## 참고사항

- `*`로 표시된 작업은 선택 사항이며 더 빠른 MVP를 위해 건너뛸 수 있습니다
- 각 작업은 추적 가능성을 위해 특정 요구사항을 참조합니다
- 체크포인트는 점진적 검증을 보장합니다
- 속성 테스트는 Hypothesis를 사용하여 보편적 정확성 속성을 검증합니다
- 단위 테스트는 pytest를 사용하여 특정 예제 및 엣지 케이스를 검증합니다
- 구현은 React UI와 Python 트레이딩 엔진 간의 Platform API 브리지를 생성합니다
- Python 트레이딩 엔진 구현은 별도의 프로젝트에서 처리됩니다
- Python FastAPI 백엔드 서비스 및 프론트엔드 통합 업데이트에 중점을 둡니다